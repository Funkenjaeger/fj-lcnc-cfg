o<issues_example> sub

#1900=#<_coord_system>  (Save current coordinate system.)
#<coordinate_system> = #5220 (Current coordinate system number: 1=G54, 9=G59.3)
#<wcs_z_varnumber> = [5203 + [20* #5220]] (5223 for G54, 5243 for G55, etc)
#<wcs_z> = #[#<wcs_z_varnumber>]
M5                                                                 (Turn spindle off)

o500 if[#<_current_tool> EQ #<_selected_tool>]                     (Same tool as before so no need to do anything.)

o500 else 
	(This is a different tool.)
	#<method>=1			(Proceed)
	M64 P1				(Turn on spindle purge air)
	
	G90 G0                                                          (Absolute distance mode Rapid move)
	G53 Z0	   	 (Change Z Position)
	
	G59.3															(Switch temporarily to G59.3 WCS for probing)
	G10 L2 P9 X0 Y0 Z0												(Zero out work coordinate offsets in G59.3)
	
	o220 if [#<_selected_tool> NE 0]
		G43																			(Enable tool length compensation)
		
		(Measure tool to get offset)
		G53 G0 X10 Y10					(Move to tool setter postion)
		G53 G0 Z-20									(Move Z  to safe height above tool setter to start probe)
		S500 M4																		(Run spindle in reverse at minimum speed)
		M64 P2																		(Turn on optical sensor)
		G90 G1 Z-40 F400
		M65 P2																		(Turn off optical sensor)
		G4 P0.2																		(Wait)
		G90 G1 Z-40 F400
		G91 G1 Z1 F400
		;G43.1 Z0																	(Dynamic Tool Length Offset set to zero.)
		G0 G91 Z1
		G91 G1 Z-2 F400
		#<new_tlo> = #5063
		G43.1 Z#<new_tlo>															(Set TLO)
		G91 G1 Z1 F400
		G91 G1 Z1 F400
		M5																			(Stop spindle)
		G90 G0																		(Absolute distance mode, Rapid move)
		G53 Z0												(Z up to safe position)
	o220 endif
	
	M65 P1				(Turn off spindle purge air)
	
	(Restore original coordinate system. G54 to G59.2 only)
	o100 if[#1900 EQ 540]
	  G54
	o100 endif
o500 endif
o<issues_example> endsub
M2
